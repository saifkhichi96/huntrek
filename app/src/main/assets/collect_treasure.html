<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="lib/cuon-matrix.js"></script>
    <script type="text/javascript" src="lib/cuon-utils.js"></script>
    <script type="text/javascript" src="lib/flatten.js"></script>
    <script type="text/javascript" src="lib/gl-matrix.min.js"></script>
    <script type="text/javascript" src="lib/initShaders.js"></script>
    <script type="text/javascript" src="lib/modelVewMatrixStack.js"></script>
    <script type="text/javascript" src="lib/webgl-debug.js"></script>
    <script type="text/javascript" src="lib/webgl-utils.js"></script>

    <script id="shader-fs" type="x-shader/x-fragment">
        precision mediump float;

        // Fragment color received from vertex shader
        varying vec3 outColor;

        varying vec2 vTexCoord;
        uniform sampler2D uTexCoord;

        void main(void) {
            vec4 texture = texture2D(uTexCoord, vTexCoord);

            if (texture[0] == 0.0 && texture[1] == 0.0 && texture[2] == 0.0)
                gl_FragColor = vec4(outColor, 1.0);
            else
                gl_FragColor = 0.25 * vec4(outColor, 1.0) + 0.75 * texture;
            }
    </script>

    <script id="shader-vs" type="x-shader/x-vertex">
        // Vertex coordinates
        uniform mat4 projectionMatrix;
        uniform mat4 modelViewMatrix;
        attribute vec3 vertexPosition;

        // Vertex normals
        uniform mat3 normalMatrix;
        attribute vec3 vertexNormal;

        // Constant ambient light
        vec3 ambientColor = vec3(0.5, 0.5, 0.5);
        
        // User-defined directional light
        uniform vec3 lightColor;
        uniform vec3 lightDirection;

        // Is the (directional) light turned on?
        uniform bool useLighting;

        // Defined vertex color
        attribute vec3 vertexColor;

        // Calculated vertex color after applying illumination
        varying vec3 outColor;

        // Mapped texture
        attribute vec2 texCoord;
        varying vec2 vTexCoord;

        void main(void) {
            // Apply transformations
            gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);

            // Calculate vertex normals
            vec3 normalVector = normalMatrix * vertexNormal;
            
            // Apply illumination
            float directionalLight = max(dot(normalVector, lightDirection), 0.0);
            vec3 directionalColor = lightColor * directionalLight;

            // Final color is average of all light sources
            if (useLighting) {
                outColor = 0.33 * (vertexColor + directionalColor + ambientColor);
            } else {
                outColor = 0.5 * (vertexColor + ambientColor);
            }

            // Pass texture coordinates to fragment shader
            vTexCoord = texCoord;
        }
    </script>

    <script type="text/javascript" src="lighting.js"></script>
    <script type="text/javascript" src="cube.js"></script>
    <script type="text/javascript" src="sphere.js"></script>
    <script type="text/javascript" src="scene.js"></script>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        cavas {
            border: none;
            position: fixed;
            padding: 0;
            margin: 0;
        }
    </style>

    <script type="text/javascript">
        function resize_canvas() {
            canvas = document.getElementById("webgl");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
    </script>
</head>

<body onload="resize_canvas(); init();" onresize="resize_canvas()">
    <canvas id="webgl">
        <p>Your browser does not support WebGL.</p>
    </canvas>
</body>

</html>